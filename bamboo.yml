project:
  key: PEGASUS
  name: Pegasus
  plans:
    - key: BNT50
      name: Build and Test (5.0)
      scm:
        - !github
          name: Pegasus
          repoSlug: pegasus-isi/pegasus
          branch: 5.0
          authType: !password
            userName: pegasus-isi
          advancedOptions:
            useShallowClones: true
      stages:
        - name: Source Checkout
          jobs:
            - key: DIST
              name: Source checkout and distribution
              description: Create the full distribution tarball
              tasks:
                - !checkout
                  description: Checks the Pegasus code out from our source repository
                  forceCleanBuild: true
                  repositories:
                    - name: Pegasus
                      checkoutDirectory: pegasus-source
                - !script
                  description: Create source tarballs
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      pwd
                      ls -la

                      VERSION=`pegasus-source/release-tools/getversion`

                      # Make sure it is clean
                      (cd pegasus-source && ant clean)

                      # basic source tarball
                      (cd pegasus-source && ant dist-source && mv dist/pegasus-$VERSION.tar.gz ..)

                      # pegasus-source.tar.gz is a tarball which is used to in subsequent buildsteps
                      # make this a copy of the generated source tarball to keep everyhing
                      # consistent
                      (cd pegasus-source/dist && tar xzf ../../pegasus-$VERSION.tar.gz && mv pegasus-$VERSION pegasus-source && tar -czf ../../pegasus-source.tar.gz pegasus-source && rm -rf pegasus-source)

                      # Create the source tarball for python source files using setup.py
                      (cd pegasus-source && ant dist-python-source && mv dist/pegasus-wms*-*.tar.gz ..)

              artifactDefinitions:
                - name: pegasus-python-source-versioned
                  copyPattern: "pegasus-wms*-*.tar.gz"
                  isShared: true
                - name: pegasus-source-versioned
                  copyPattern: "pegasus-?.*.tar.gz"
                  isShared: true
                - name: pegasus-source
                  copyPattern: "pegasus-source.tar.gz"
                  isShared: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true

        - name: Unit Tests
          description: Run Unit Tests on Code and Binaries
          jobs:
            - key: A3UT
              name: Alpine 3 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer alpine-3 \
                          ant test-kickstart test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: A3JUT
              name: Alpine 3 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer alpine-3 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: A3PUT
              name: Alpine 3 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer alpine-3 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D10CUT
              name: Debian 10 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-10 \
                          ant test-kickstart test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D10JUT
              name: Debian 10 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-10 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D10PUT
              name: Debian 10 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-10 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D11CUT
              name: Debian 11 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-11 \
                          ant test-kickstart test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D11JUT
              name: Debian 11 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-11 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D11PUT
              name: Debian 11 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-11 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: OCUT
              name: OSX Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  environmentVariables: 'PATH="${PATH}:/usr/local/bin"'
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      # We need /usr/local/bin because of homebrew
                      export PATH=$PATH:/usr/local/bin:/Library/TeX/texbin
                      cd pegasus-source
                      ant test-kickstart test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: platform
                  matchType: !equals
                    matchValue: macos
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R7CUT
              name: RHEL 7 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-7 \
                          ant test-kickstart test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R7JUT
              name: RHEL 7 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-7 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R7PUT
              name: RHEL 7 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-7 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R8CUT
              name: RHEL 8 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-8 \
                          ant test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R8JUT
              name: RHEL 8 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-8 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R8PUT
              name: RHEL 8 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-8 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R9CUT
              name: RHEL 9 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-9 \
                          ant test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R9JUT
              name: RHEL 9 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-9 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R9PUT
              name: RHEL 9 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-9 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTCUB
              name: Ubuntu 18.04 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-18 \
                          ant test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTJUB
              name: Ubuntu 18.04 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-18 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTPUB
              name: Ubuntu 18.04 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-18 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTCUF
              name: Ubuntu 20.04 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-20 \
                          ant test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTJUF
              name: Ubuntu 20.04 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-20 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTPUF
              name: Ubuntu 20.04 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-20 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UJCUF
              name: Ubuntu 22.04 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-22 \
                          ant test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UJJUF
              name: Ubuntu 22.04 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-22 \
                          ant test-java
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/build/tests/classes/junitreport/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UJPUF
              name: Ubuntu 22.04 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-22 \
                          ant test-python
                - !junitParser
                  description: Parse Test Report
                  testResultsDirectory: pegasus-source/packages/*/test-reports/*.xml
                  pickUpTestResultsCreatedOutsideOfBuild: false
              artifactDefinitions:
                - name: Coverage Report - Pegasus Common
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-common/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus API
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-api/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus DAX
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-dax-python/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus Worker
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-worker/htmlcov/
                  isShared: false
                - name: Coverage Report - Pegasus WMS
                  copyPattern: "*"
                  location: pegasus-source/packages/pegasus-python/htmlcov/
                  isShared: false
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true

        - name: Lint
          description: Lint source code
          jobs:
            - key: JCF
              name: Java Code Format
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Code Format
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export USER=bamboo
                      export CI=true
                      export bamboo_buildKey=${bamboo_buildKey}
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-8 \
                          ant code-format-java
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: PCF
              name: Python Code Format
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Code Format
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export USER=bamboo
                      export CI=true
                      export bamboo_buildKey=${bamboo_buildKey}
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-8 \
                          ant code-format-python
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true

        - name: Build
          description: Build Pegasus
          jobs:
            - key: DOCGEN
              name: Build Docs
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Doc Build
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-8 \
                          ant dist-doc
              artifactDefinitions:
                - name: pegasus-doc
                  copyPattern: "pegasus-doc-*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BR
              name: Build R
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Build R DAX Package
                  taskConfig:
                    label: Ant
                    target: dist-r
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-r-pegasus
                  copyPattern: "pegasus-r-pegasus*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BA3
              name: Build Alpine 3
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer alpine-3 \
                          ant dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_alpine_3
                  copyPattern: "pegasus-binary-*-x86_64_alpine_3.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_alpine_3
                  copyPattern: "pegasus-worker-*-x86_64_alpine_3.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR7
              name: Build RHEL 7
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-7 \
                          ant dist-rpm dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_rhel_7
                  copyPattern: "pegasus-binary-*-x86_64_rhel_7.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-x86_64_rhel_7
                  copyPattern: "*x86_64.rpm"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_rhel_7
                  copyPattern: "pegasus-worker-*-x86_64_rhel_7.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR8
              name: Build RHEL 8
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-8 \
                          ant dist-rpm dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_rhel_8
                  copyPattern: "pegasus-binary-*-x86_64_rhel_8.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-x86_64_rhel_8
                  copyPattern: "*x86_64.rpm"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_rhel_8
                  copyPattern: "pegasus-worker-*-x86_64_rhel_8.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR8A
              name: Build RHEL 8 (Arm)
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      docker run -i --rm -v `pwd`:/srv -w /srv rockylinux:8 bash -s <<EOT
                      set -ex
                      yum install -y epel-release rpm-build
                      yum install -y --enablerepo=powertools git gcc gcc-c++ javapackages-tools make openssl-devel ant R-devel python3-devel python3-setuptools java-11-openjdk-devel python3-setuptools_scm
                      ant dist-rpm dist-worker dist-release
                      EOT
              artifactDefinitions:
                - name: pegasus-binary-aarch64_rhel_8
                  copyPattern: "pegasus-binary-*-aarch64_rhel_8.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-aarch64_rhel_8
                  copyPattern: "*aarch64.rpm"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-aarch64_rhel_8
                  copyPattern: "pegasus-worker-*-aarch64_rhel_8.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: arch
                  matchType: !matches
                    regex: ^(aarch|arm)64$
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR9
              name: Build RHEL 9
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer rhel-9 \
                          ant dist-rpm dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_rhel_9
                  copyPattern: "pegasus-binary-*-x86_64_rhel_9.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-x86_64_rhel_9
                  copyPattern: "*x86_64.rpm"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_rhel_9
                  copyPattern: "pegasus-worker-*-x86_64_rhel_9.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-srcrpm
                  copyPattern: "*.src.rpm"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR9A
              name: Build RHEL 9 (Arm)
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      docker run -i --rm -v `pwd`:/srv -w /srv rockylinux:9 bash -s <<EOT
                      set -ex
                      yum install -y epel-release rpm-build
                      yum install -y --enablerepo=devel git gcc gcc-c++ javapackages-tools make openssl-devel ant R-devel python3-devel python3-setuptools ant-apache-regexp java-11-openjdk-devel
                      ant dist-rpm dist-worker dist-release
                      EOT
              artifactDefinitions:
                - name: pegasus-binary-aarch64_rhel_9
                  copyPattern: "pegasus-binary-*-aarch64_rhel_9.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-aarch64_rhel_9
                  copyPattern: "*aarch64.rpm"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-aarch64_rhel_9
                  copyPattern: "pegasus-worker-*-aarch64_rhel_9.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: arch
                  matchType: !matches
                    regex: ^(aarch|arm)64$
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BDEB10
              name: Build Debian 10
              enabled: true
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-10 \
                          ant dist-worker dist-release dist-deb
              artifactDefinitions:
                - name: pegasus-binary-x86_64_deb_10
                  copyPattern: "pegasus-binary-*-x86_64_deb_10.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_deb_10
                  copyPattern: "*.deb"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_deb_10
                  copyPattern: "pegasus-worker-*-x86_64_deb_10.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BDEB11
              name: Build Debian 11
              enabled: true
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer debian-11 \
                          ant dist-worker dist-release dist-deb
              artifactDefinitions:
                - name: pegasus-binary-x86_64_deb_11
                  copyPattern: "pegasus-binary-*-x86_64_deb_11.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_deb_11
                  copyPattern: "*.deb"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_deb_11
                  copyPattern: "pegasus-worker-*-x86_64_deb_11.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXOSXI12
              name: Build macOS Intel 12
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Binary Packages
                  taskConfig:
                    label: Ant
                    environmentVariables: 'PATH="${PATH}:/usr/local/bin"'
                    target: dist-worker dist-release
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-binary-x86_64_macos_12
                  copyPattern: "pegasus-binary-*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_macos_12
                  copyPattern: "pegasus-worker-*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: arch
                  matchType: !equals
                    matchValue: x86_64
                - capabilityKey: platform
                  matchType: !equals
                    matchValue: macos
                - capabilityKey: release
                  matchType: !matches
                    regex: 12\..*
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXOSXA12
              name: Build macOS Arm 12
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Binary Packages
                  taskConfig:
                    label: Ant
                    environmentVariables: 'PATH="${PATH}:/opt/homebrew/bin'
                    target: dist-worker dist-release
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-binary-arm64_macos_12
                  copyPattern: "pegasus-binary-*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-arm64_macos_12
                  copyPattern: "pegasus-worker-*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: arch
                  matchType: !equals
                    matchValue: arm64
                - capabilityKey: platform
                  matchType: !equals
                    matchValue: macos
                - capabilityKey: release
                  matchType: !matches
                    regex: 12\..*
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXOSXA13
              name: Build macOS Arm 13
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Binary Packages
                  taskConfig:
                    label: Ant
                    environmentVariables: 'PATH="${PATH}:/opt/homebrew/bin'
                    target: dist-worker dist-release
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-binary-arm64_macos_13
                  copyPattern: "pegasus-binary-*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-arm64_macos_13
                  copyPattern: "pegasus-worker-*.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: arch
                  matchType: !equals
                    matchValue: arm64
                - capabilityKey: platform
                  matchType: !equals
                    matchValue: macos
                - capabilityKey: release
                  matchType: !matches
                    regex: 13\..*
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXUB
              name: Build Ubuntu 18.04 LTS
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-18 \
                          ant dist-worker dist-release dist-deb
              artifactDefinitions:
                - name: pegasus-binary-x86_64_ubuntu_18
                  copyPattern: "pegasus-binary-*-x86_64_ubuntu_18.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_ubuntu_18
                  copyPattern: "*.deb"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_ubuntu_18
                  copyPattern: "pegasus-worker-*-x86_64_ubuntu_18.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXUF
              name: Build Ubuntu 20.04 LTS
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-20 \
                          ant dist-worker dist-release dist-deb
              artifactDefinitions:
                - name: pegasus-binary-x86_64_ubuntu_20
                  copyPattern: "pegasus-binary-*-x86_64_ubuntu_20.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_ubuntu_20
                  copyPattern: "*.deb"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_ubuntu_20
                  copyPattern: "pegasus-worker-*-x86_64_ubuntu_20.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXJF
              name: Build Ubuntu 22.04 LTS
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      cd pegasus-source
                      scitech-bamboo-apptainer ubuntu-22 \
                          ant dist-worker dist-release dist-deb
              artifactDefinitions:
                - name: pegasus-binary-x86_64_ubuntu_22
                  copyPattern: "pegasus-binary-*-x86_64_ubuntu_22.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_ubuntu_22
                  copyPattern: "*.deb"
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_ubuntu_22
                  copyPattern: "pegasus-worker-*-x86_64_ubuntu_22.tar.gz"
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: apptainer
                  matchType: !equals
                    matchValue: true
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true

        - name: Deploy
          description: Deploy Artifacts
          jobs:
            - key: DA
              name: Deploy Artifacts
              tasks:
                - !script
                  description: Organize artifacts for upload
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      echo
                      echo "Available artifacts are:"
                      ls -lh
                      echo

                      tar xzf pegasus-source.tar.gz
                      VERSION=`./pegasus-source/release-tools/getversion`
                      if [ "X$VERSION" = "X" ]; then
                          echo "Unable to determine Pegasus version! Exiting..."
                          exit 1
                      fi

                      mkdir -p docs
                      tar xzf pegasus-doc-*.tar.gz -C docs

                      DOWNLOADS=pegasus/$VERSION
                      mkdir -p $DOWNLOADS
                      mv pegasus-5*.tar.gz $DOWNLOADS/
                      mv pegasus-wms*-*.tar.gz $DOWNLOADS/
                      mv pegasus-binary-*.tar.gz $DOWNLOADS/
                      mv pegasus-worker-*.tar.gz $DOWNLOADS/
                      mv pegasus-doc-*.tar.gz $DOWNLOADS/
                      mv *.deb $DOWNLOADS/
                      mv *.rpm $DOWNLOADS/
                      mv pegasus-r-pegasus*.tar.gz $DOWNLOADS/

                      # debian
                      mkdir -p $DOWNLOADS/debian/dists/buster/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*deb10_amd64.deb $DOWNLOADS/debian/dists/buster/main/binary-amd64/
                      mkdir -p $DOWNLOADS/debian/dists/bullseye/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*deb11_amd64.deb $DOWNLOADS/debian/dists/bullseye/main/binary-amd64/

                      # ubuntu
                      mkdir -p $DOWNLOADS/ubuntu/dists/bionic/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*ubuntu18_amd64.deb $DOWNLOADS/ubuntu/dists/bionic/main/binary-amd64/
                      mkdir -p $DOWNLOADS/ubuntu/dists/focal/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*ubuntu20_amd64.deb $DOWNLOADS/ubuntu/dists/focal/main/binary-amd64/
                      mkdir -p $DOWNLOADS/ubuntu/dists/jammy/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*ubuntu22_amd64.deb $DOWNLOADS/ubuntu/dists/jammy/main/binary-amd64/

                      # rhel
                      mkdir -p $DOWNLOADS/rhel/src
                      cp $DOWNLOADS/pegasus-*.src.rpm $DOWNLOADS/rhel/src/
                      mkdir -p $DOWNLOADS/rhel/7/x86_64
                      cp $DOWNLOADS/pegasus-*el7.x86_64.rpm $DOWNLOADS/rhel/7/x86_64/
                      mkdir -p $DOWNLOADS/rhel/8/x86_64
                      cp $DOWNLOADS/pegasus-*el8.x86_64.rpm $DOWNLOADS/rhel/8/x86_64/
                      mkdir -p $DOWNLOADS/rhel/8/aarch64
                      cp $DOWNLOADS/pegasus-*el8.aarch64.rpm $DOWNLOADS/rhel/8/aarch64/
                      mkdir -p $DOWNLOADS/rhel/9/x86_64
                      cp $DOWNLOADS/pegasus-*el9.x86_64.rpm $DOWNLOADS/rhel/9/x86_64/
                      mkdir -p $DOWNLOADS/rhel/9/aarch64
                      cp $DOWNLOADS/pegasus-*el9.aarch64.rpm $DOWNLOADS/rhel/9/aarch64/

                      # standard filenames for RPMs - used by tutorial VM
                      cd pegasus/$VERSION
                      if [ ! -e pegasus-$VERSION-1.el7.x86_64.rpm ]; then
                          cp pegasus-*el7.x86_64.rpm pegasus-$VERSION-1.el7.x86_64.rpm
                      fi
                      if [ ! -e pegasus-$VERSION-1.el8.x86_64.rpm ]; then
                          cp pegasus-*el8.x86_64.rpm pegasus-$VERSION-1.el8.x86_64.rpm
                      fi
                      if [ ! -e pegasus-$VERSION-1.el9.x86_64.rpm ]; then
                          cp pegasus-*el9.x86_64.rpm pegasus-$VERSION-1.el9.x86_64.rpm
                      fi
                      # standard filesnames for DEBs
                      for TIMESTAMPED in `ls *dev20*.deb`; do
                          SIMPLE=`echo $TIMESTAMPED | sed -E 's/dev20[0-9]+/dev/'`
                          if [ ! -e $SIMPLE ]; then
                              cp $TIMESTAMPED $SIMPLE
                          fi
                      done
                      cd ../..

                      # no files should be left behind
                      ls -l

                      scp -i ~/.ssh/deployment -r $DOWNLOADS download.pegasus.isi.edu:/srv/download.pegasus.isi.edu/public_html/pegasus/

                      # new download site - do this in parallel for now
                      scp -i ~/.ssh/deployment -r $DOWNLOADS scitech-web.isi.edu:/srv/download.pegasus.isi.edu/public_html/pegasus/

                      # new wordpress site
                      ssh -i ~/.ssh/deployment pegasus.isi.edu "mkdir -p /srv/pegasus.isi.edu/public_html/docs/$VERSION"
                      scp -i ~/.ssh/deployment -r docs/pegasus-*/share/doc/pegasus/wordpress/* pegasus.isi.edu:/srv/pegasus.isi.edu/public_html/docs/$VERSION/
              artifactDependencies:
                - name: pegasus-binary-x86_64_alpine_3
                - name: pegasus-binary-x86_64_deb_10
                - name: pegasus-binary-x86_64_deb_11
                - name: pegasus-binary-x86_64_macos_12
                - name: pegasus-binary-arm64_macos_12
                - name: pegasus-binary-arm64_macos_13
                - name: pegasus-binary-x86_64_rhel_7
                - name: pegasus-binary-x86_64_rhel_8
                - name: pegasus-binary-aarch64_rhel_8
                - name: pegasus-binary-x86_64_rhel_9
                - name: pegasus-binary-aarch64_rhel_9
                - name: pegasus-binary-x86_64_ubuntu_18
                - name: pegasus-binary-x86_64_ubuntu_20
                - name: pegasus-binary-x86_64_ubuntu_22
                - name: pegasus-deb-x86_64_deb_10
                - name: pegasus-deb-x86_64_deb_11
                - name: pegasus-deb-x86_64_ubuntu_18
                - name: pegasus-deb-x86_64_ubuntu_20
                - name: pegasus-deb-x86_64_ubuntu_22
                - name: pegasus-doc
                - name: pegasus-python-source-versioned
                - name: pegasus-r-pegasus
                - name: pegasus-rpm-x86_64_rhel_7
                - name: pegasus-rpm-x86_64_rhel_8
                - name: pegasus-rpm-aarch64_rhel_8
                - name: pegasus-rpm-x86_64_rhel_9
                - name: pegasus-rpm-aarch64_rhel_9
                - name: pegasus-source
                - name: pegasus-source-versioned
                - name: pegasus-srcrpm
                - name: pegasus-worker-x86_64_alpine_3
                - name: pegasus-worker-x86_64_deb_10
                - name: pegasus-worker-x86_64_deb_11
                - name: pegasus-worker-x86_64_macos_12
                - name: pegasus-worker-arm64_macos_12
                - name: pegasus-worker-arm64_macos_13
                - name: pegasus-worker-x86_64_rhel_7
                - name: pegasus-worker-x86_64_rhel_8
                - name: pegasus-worker-aarch64_rhel_8
                - name: pegasus-worker-x86_64_rhel_9
                - name: pegasus-worker-aarch64_rhel_9
                - name: pegasus-worker-x86_64_ubuntu_18
                - name: pegasus-worker-x86_64_ubuntu_20
                - name: pegasus-worker-x86_64_ubuntu_22
              requirements:
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
        - name: Container Images
          description: Build and upload container images
          jobs:
            - key: TDI
              name: Tutorial Docker Image
              tasks:
                - !script
                  description: Builds and uploads a tutorial image to DockerHub
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      tar xzf pegasus-source.tar.gz
                      VERSION=`./pegasus-source/release-tools/getversion`
                      if [ "X$VERSION" = "X" ]; then
                          echo "Unable to determine Pegasus version! Exiting..."
                          exit 1
                      fi

                      cd pegasus-source
                      ant tutorial-image-build

                      docker push pegasus/tutorial:$VERSION

              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
      permissions:
        user:
          mayani:
            - !permission ADMIN
        group:
          ccg-users:
            - !permission VIEW
            - !permission BUILD
        other:
          !userType ANONYMOUS_USERS:
            - !permission VIEW
          !userType LOGGED_IN_USERS:
            - !permission VIEW
      triggers:
        - !scheduled
          description: Nightly Build
          cronExpression: "0 0 21 * * ?"
        - !polling
          description: Repository Polling
          repositories:
            - Pegasus
          periodicTrigger:
            pollingFrequencyInSecs: 300
      notifications:
        - !email
          address: pegasus-svn@isi.edu
          event: !event JOB_HUNG
        - !customNotification
          event: !event JOB_HUNG
          notificationRecipientType: "com.atlassian.bamboo.plugins.bamboo-slack:recipient.slack"
          config:
            webhookUrl: ["${bamboo.PEGASUS_SLACK_WEBHOOK}"]
            channel: ["#github-notifications"]
            botName: [Bamboo]
        - !email
          address: pegasus-svn@isi.edu
          event: !event FAILED_BUILDS_AND_FIRST_SUCCESSFUL
        - !customNotification
          event: !event FAILED_BUILDS_AND_FIRST_SUCCESSFUL
          notificationRecipientType: "com.atlassian.bamboo.plugins.bamboo-slack:recipient.slack"
          config:
            webhookUrl: ["${bamboo.PEGASUS_SLACK_WEBHOOK}"]
            channel: ["#github-notifications"]
            botName: [Bamboo]
      variables:
        - key: TAG_CENTOS_7
          value: centos7
        - key: TAG_CENTOS_8
          value: centos8
        - key: TAG_DEBIAN_10
          value: buster
        - key: TAG_DEBIAN_11
          value: bullseye
        - key: TAG_UBUNTU_18
          value: bionic
        - key: TAG_UBUNTU_20
          value: focal

    - key: WT50
      name: Workflow Tests (5.0)
      scm:
        - !git
          name: Pegasus
          url: https://github.com/pegasus-isi/pegasus.git
          branch: master
      stages:
        - name: Setup
          description: Setup
          jobs:
            - key: BP
              name: Build Pegasus
              description: Build Pegasus
              tasks:
                - !checkout
                  description: Checks the Pegasus code out from our source repository
                  forceCleanBuild: true
                  repositories:
                    - name: Pegasus
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Binary Packages
                  taskConfig:
                    label: Ant
                    environmentVariables: "PATH=/usr/lib64/mpich/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin"
                    target: dist-worker dist-common compile-pegasus-mpi-cluster
                    buildJdk: JDK
                - !script
                  description: Install Binaries
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      TARGET_DIR=/scitech/shared/scratch-90-days/bamboo/installs

                      NAME=`cd dist && ls | grep -v tar | grep pegasus`
                      echo "Found $NAME"

                      mkdir -p $TARGET_DIR
                      rm -rf $TARGET_DIR/$NAME
                      cp -r dist/$NAME $TARGET_DIR
                - !script
                  description: Create Test Tarball
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      rm -f tests.tar
                      tar cf tests.tar test/
                      cd dist
                      mv pegasus-*/ pegasus

                      # Later on we need to include the worker package
                      #tar rf ../tests.tar pegasus/ pegasus-worker-*.tar.gz
                      tar rf ../tests.tar pegasus/
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDefinitions:
                - name: tests
                  copyPattern: "tests.tar"
                  isShared: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false

        - name: Workflow Tests
          description: Workflow Tests
          jobs:
            - key: CHECKENV
              name: 000-check-env
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "#rm -rf /scitech/home/bamboo/.pegasus/workflow.db"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: T1
              name: 001-black-diamond-vanilla-condor
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1V5
              name: 001-black-diamond-vanilla-condor-5.0API
              description: Black Diamond test with YAML format
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T2V1
              name: 002-hello-world
              description: Minimal Hello World API example
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4N6
              name: 004-montage-condor-io
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4M1
              name: 004-montage-shared-fs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: SC004MON
              name: 004-montage-shared-fs-sc
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4N12
              name: 004-montage-staging-site
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4M2
              name: 004-montage-universe-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4N13
              name: 004-montage-apptainer
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T005
              name: 005-galactic-plane
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T6
              name: 006-black-diamond-shell-code-generator
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-status ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T7
              name: 007-black-diamond-pegasuslite-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T8
              name: 008-black-diamond-pegasuslite-condorio
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T9
              name: 009-black-diamond-pegasuslite-pegasustransfer
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T9A
              name: 009-black-diamond-pegasuslite-pegasustransfer-a
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10A
              name: 010-runtime-clustering - CondorIO
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-condorio
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10B
              name: 010-runtime-clustering - Non-SharedFS
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-nonsharedfs
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10C
              name: 010-runtime-clustering - SharedFS
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-sharedfs
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10D
              name: 010-runtime-clustering SharedFS Staging and No Kickstart
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-sharedfs-all-staging-nogridstart
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T11
              name: 011-rosetta-staging-site
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T12
              name: 012-blackdiamond-invoke
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: TESTMPIDAG
              name: 013-pegasus-mpi-cluster
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  environmentVariables: "PATH=/usr/lib64/mpich/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin"
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T15
              name: 015-shell-hierarchic-workflow
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-status ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T016
              name: 016-pegasus-transfer
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: T18A
              name: 018-black-condorc-condor-io
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T18C
              name: 018-black-condorc-hybrid
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T18B
              name: 018-black-condorc-staging-site
              enabled: false
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T19A
              name: 019-black-label
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PMCONLY
              name: 020-pmc-only
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  environmentVariables: "PATH=/usr/lib64/mpich/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin"
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-status ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T21A
              name: 021-black-dir
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: BNT22A
              name: 022-data-reuse-full-a
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: BNT022B
              name: 022-data-reuse-full-b
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T22
              name: 022-data-reuse-regexrc
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T023
              name: 023-sc4-ssh-http
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T024
              name: 024-sc4-gridftp-http
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T025
              name: 025-sc4-file-http
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T26
              name: 026-cache-url-check
              description: TODO
              enabled: true
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T27A
              name: 027-montage-bypass-staging-site
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T27B
              name: 027-montage-bypass-staging-site-condorio
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T28A
              name: 028-dynamic-hierarchy
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T028B
              name: 028-dynamic-hierarchy-b
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T29A
              name: 029-black-quiet
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PEG030GS
              name: 030-pegasuslite-gs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PEG030
              name: 030-pegasuslite-irods
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PEG030S3
              name: 030-pegasuslite-s3
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: SSHFTP030
              name: 030-pegasuslite-sshftp
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: RC031MON
              name: 031-montage-condor-io-jdbcrc
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T31A
              name: 031-montage-jdbcrc-sqlite
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T32A
              name: 032-black-chkpoint
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T32B
              name: 032-kickstart-chkpoint-signal-condorio
              description: Testing that kickstart sends SIGTERM to job executable for checkpointing
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T32C
              name: 032-kickstart-chkpoint-signal-nonsharedfs
              description: Testing that kickstart sends SIGTERM to job executable for checkpointing
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33
              name: 033-pegasuslite-multi
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33A
              name: 033-pegasuslite-multi-wp-a
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33B
              name: 033-pegasuslite-multi-wp-b
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33C
              name: 033-pegasuslite-multi-wp-c
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T34C
              name: 034-recursive-cluster-condorio
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T34B
              name: 034-recursive-cluster-nonsharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T34A
              name: 034-recursive-cluster-sharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T35
              name: 035-black-transfer
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T36
              name: 036-condorio-no-outputs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T37
              name: 037-black-hints
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T038
              name: 038-halt-continue
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T39A
              name: 039-black-metadata
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T040N1
              name: 040-multiple-input-sources-nonsharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T040N2
              name: 040-multiple-input-sources-sharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T042B
              name: 042-kswrapper-nonsharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T042A
              name: 042-kswrapper-sharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043A
              name: 043-integrity-condorio
              description: Integrity checking on for the whole workflow
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043B
              name: 043-integrity-nonsharedfs
              description: Integrity checking with nonsharedfs
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043C
              name: 043-integrity-nonsharedfs-nosymlink
              description: Integrity checking with nonsharedfs with nosymlink dial
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043D
              name: 043-integrity-condorio-nogs
              description: Integrity checking with PegasusLite and Condorio but some jobs launched without kickstart
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043SYN
              name: 043-integrity-synthetic-with-errors
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043E
              name: 043-integrity-condorio-5.0API
              description: Integrity checking on for the whole workflow using 5.0 API
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043F
              name: 043-integrity-bypass-staging
              description: Integrity checking when using bypass staging
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043G
              name: 043-integrity-condorio-singularity
              description: Integrity checking on for the whole workflow including associated singularity containers
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043H
              name: 043-integrity-bypass-staging-b
              description: nonsharedfs with containers and per file bypass on for files, executables and containers
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044A
              name: 044-docker-nonsharedfs
              description: nonsharedfs test with docker containers and executable staging
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044B
              name: 044-docker-nonsharedfs-shared
              description: Docker in nonsharedfs with a shared filesystem
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044C
              name: 044-singularity-nonsharedfs
              description: Singularity nonsharedfs case
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044D
              name: 044-singularity-nonsharedfs-shared
              description: Singularity test case
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044F
              name: 044-docker-nonsharedfs-symlink
              description: Docker in nonsharedfs with a shared filesystem and symlinking
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044G
              name: 044-singularity-nonsharedfs-symlink
              description: Singularity in nonsharedfs with a shared filesystem and symlinking
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044H
              name: 044-singularity-nonsharedfs-symlink-cvmfs
              description: Singularity in nonsharedfs with a shared filesystem and symlinking of container image from cvmfs
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044I
              name: 044-singularity-nonsharedfs-minimal
              description: Singularity in nonsharedfs, with a minimal image
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T045A
              name: 045-hierarchy-sharedfs
              description: Baseline hierarchal workflow
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T045B
              name: 045-hierarchy-sharedfs-b
              description: Baseline hierarchal workflow in sharedfs and worker package staging turned on
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T045C
              name: 045-hierarchy-sharedfs-c
              description: Baseline hierarchal workflow in nonsharedfs, with compute job dependent on outputs of a sub workflow
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T045D
              name: 045-hierarchy-sharedfs-d
              description: Hierarchical Workflow with 2 sub workflows in condorio, and each listing what files it requires and generates.
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T046A
              name: 046-aws-batch-black
              description: Blackdiamond workflow with horizontal clustering and clusters run on AWS Batch
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T047A
              name: 047-cwl
              description: CWL workflow converted to pegasus yaml format, then run on condor pool
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T047B
              name: 047-cwl-docker-black-diamond
              description: Blackdiamond workflow in CWL that uses containers converted to native Pegasus format
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T048A
              name: 048-black-deep-condorio
              description: Blackdiamond workflow that uses deep LFN with CondorIO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T048B
              name: 048-black-deep-condorio-local
              description: Blackdiamond workflow that uses deep LFN with CondorIO and runs jobs in local universe
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T048
              name: 048-ligo-getenv
              description: Tests if Pegasus pollutes the job environment when using getenv=true
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1D
              name: blackdiamond - pl-condorio
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-condorio
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1B
              name: blackdiamond - pl-condorio-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-condorio-local
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1E
              name: blackdiamond - pl-pt
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-pt
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1C
              name: blackdiamond - pl-pt-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-pt-local
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1F
              name: blackdiamond - sharedfs-symlink-nogridstart
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond sharedfs-symlink-nogridstart
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1G
              name: blackdiamond - sharedfs-worker-staging-cleanup
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond sharedfs-worker-staging-cleanup
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1A
              name: blackdiamond - vanilla-condor
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond vanilla-condor
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false

        - name: Performance Tests
          description: Performance Tests
          jobs:
            - key: T014
              name: 014-planner-performance
              description: Planner performance
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T014100K
              name: 014-planner-performance-100k
              description: Planner performance 100K
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T014C
              name: 014-planner-performance-ahope
              description: A LIGO ahope test case with Shell code generator
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T014HCC
              name: 014-planner-performance-hcc
              description: Planner performance HCC
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: JDBCPERF
              name: 041-jdbcrc-performance
              description: JDBC RC performance
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
      permissions:
        user:
          mayani:
            - !permission ADMIN
        group:
          ccg-users:
            - !permission VIEW
            - !permission BUILD
        other:
          !userType ANONYMOUS_USERS:
            - !permission VIEW
          !userType LOGGED_IN_USERS:
            - !permission VIEW
      triggers:
        - !scheduled
          description: Nightly Build
          cronExpression: "0 0 20 * * ?"
          onlyRunIfOtherPlansArePassing:
            planKeys:
              - PEGASUS-BNT50
      notifications:
        - !email
          address: pegasus-svn@isi.edu
          event: !event JOB_HUNG
        - !email
          address: pegasus-svn@isi.edu
          event: !event FAILED_BUILDS_AND_FIRST_SUCCESSFUL
